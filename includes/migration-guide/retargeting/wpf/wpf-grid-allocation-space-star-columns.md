### <a name="wpf-grid-allocation-of-space-to-star-columns"></a>Allocation par Grid de l’espace aux colonnes * dans WPF

|   |   |
|---|---|
|Détails|À compter du .NET Framework 4.7, WPF remplace l’algorithme que le contrôle <xref:System.Windows.Controls.Grid> utilise pour allouer de l’espace aux colonnes *. Il en résulte un changement de la largeur réelle affectée aux colonnes * dans plusieurs cas :<ul><li>Quand une ou plusieurs colonnes * ont également une largeur minimale ou maximale qui remplace l’allocation proportionnelle pour cette colonne. (La largeur minimale peut dériver d’une déclaration MinWidth explicite, ou d’un minimum implicite obtenu à partir du contenu de la colonne. La largeur maximale ne peut être définie qu’explicitement, à partir d’une déclaration MaxWidth.)</li><li>Quand une ou plusieurs colonnes * déclarent un très grand poids *, supérieur à 10^298.</li><li>Quand les poids * sont suffisamment différents pour rencontrer une instabilité du calcul en virgule flottante (dépassement de capacité positif ou négatif, perte de précision).</li><li>Lorsque l’arrondi de disposition est activé, et que la résolution d’affichage efficace en PPP est suffisamment élevée.</li></ul>Dans les deux premiers cas, les largeurs produites par le nouvel algorithme peuvent être considérablement différentes de celles générées par l’ancien algorithme ; dans le dernier cas, la différence est au plus de un ou deux pixels. Le nouvel algorithme résout plusieurs bogues présents dans l’ancien algorithme :<ol><li>L’allocation totale à des colonnes peut dépasser la largeur de la grille. Cela peut se produire lors de l’allocation d’espace pour une colonne dont la part proportionnelle est inférieure à sa taille minimale. L’algorithme alloue la taille minimale, ce qui réduit l’espace disponible pour les autres colonnes. S’il ne reste aucune colonne * à allouer, l’allocation totale est trop grande.</li><li>L’allocation totale peut être inférieure à la largeur de la grille. C’est le double problème pour #1, survenant lors de l’affectation à une colonne dont la part proportionnelle est supérieure à sa taille maximale, sans colonnes * restantes pour combler.</li><li>Deux colonnes * peuvent recevoir des allocations non proportionnelles à leurs poids *. Il s’agit d’une version atténuée de #1/2, survenant lors de l’allocation aux colonnes * A, B et C (dans cet ordre), où la part proportionnelle de B ne respecte pas la contrainte min (ou max). Comme ci-dessus, cela modifie l’espace disponible pour la colonne C, qui obtient une allocation proportionnelle inférieure (ou supérieure) à A,</li><li>Les colonnes avec des poids extrêmement volumineux (&gt; 10^298) sont traitées comme si elles avaient un poids de 10^298. Les différences proportionnelles entre elles (et entre les colonnes avec des poids légèrement inférieurs) ne sont pas respectées.</li><li>Les colonnes avec des poids infinis ne sont pas gérées correctement. [Il est en fait impossible de définir un poids infini, mais il s’agit d’une restriction artificielle. Le code d’allocation essayait de le gérer, sans succès.]</li><li>Plusieurs problèmes mineurs en évitant le dépassement de capacité positif ou négatif, la perte de précision et autres problèmes liées aux nombres à virgule flottante.</li><li>Les ajustements d’arrondi de disposition sont incorrects à un niveau de PPP suffisamment élevé.</li></ol>Le nouvel algorithme produit des résultats qui répondent aux critères suivants : A. La largeur réelle affectée à une colonne * n’est jamais inférieure à sa largeur minimale ni supérieure à sa largeur maximale. B. Chaque colonne  <em>qui n’a pas de largeur minimale ou maximale affectée reçoit une largeur proportionnelle à son poids <em>. Pour être exact, si deux colonnes sont déclarées avec les largeurs x</em> et y</em>, respectivement, et qu’aucune colonne ne reçoit sa largeur minimale ou maximale, les largeurs effectives v et w affectées aux colonnes respectent les mêmes proportions: v / w == x / y. C. La largeur totale allouée aux colonnes &quot;proportionnelles&quot; est égale à l’espace disponible après avoir alloué les colonnes avec contrainte (les colonnes fixes, auto, et * affectées à leur largeur min ou max). Cela peut être égal à zéro, par exemple si la somme des largeurs minimales dépasse la largeur disponible de la grille. D. Toutes ces instructions doivent être interprétées en considérant la disposition &quot;idéale&quot;. Quand l’arrondi de disposition est activé, la largeur réelle peut différer de la largeur idéale jusqu’à un pixel. L’ancien algorithme respectait (A), sans pouvoir en faire autant pour les autres critères dans les cas présentés ci-dessus. Tout ce qui a été dit dans cet article sur les colonnes et les largeurs s’applique également aux lignes et aux hauteurs.|
|Suggestion|Par défaut, les applications qui ciblent les versions 4.7 ou ultérieures du .NET Framework utilisent le nouvel algorithme, tandis que les applications qui ciblent le .NET Framework 4.6.2 ou versions antérieures utilisent l’ancien algorithme. Pour remplacer la valeur par défaut, utilisez le paramètre de configuration suivant :<pre><code class="language-xml">&lt;runtime&gt;&#13;&#10;&lt;AppContextSwitchOverrides value=&quot;Switch.System.Windows.Controls.Grid.StarDefinitionsCanExceedAvailableSpace=true&quot; /&gt;&#13;&#10;&lt;/runtime&gt;&#13;&#10;</code></pre>La valeur true sélectionne l’ancien algorithme, et false le nouvel algorithme.|
|Portée|Mineur|
|Version|4.7|
|Type|Reciblage|

